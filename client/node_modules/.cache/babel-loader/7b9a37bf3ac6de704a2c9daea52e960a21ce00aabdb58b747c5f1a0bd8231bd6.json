{"ast":null,"code":"class ImageUploader {\n  constructor(quill, options) {\n    this.quill = quill;\n    this.options = options;\n    this.range = null;\n    const toolbar = this.quill.getModule(\"toolbar\");\n    toolbar.addHandler(\"image\", this.selectLocalImage.bind(this));\n    this.handleDrop = this.handleDrop.bind(this);\n    this.handlePaste = this.handlePaste.bind(this);\n    this.quill.root.addEventListener(\"drop\", this.handleDrop, false);\n    this.quill.root.addEventListener(\"paste\", this.handlePaste, false);\n  }\n  selectLocalImage() {\n    this.range = this.quill.getSelection();\n    if (this.range) {\n      this.fileHolder = document.createElement(\"input\");\n      this.fileHolder.setAttribute(\"type\", \"file\");\n      this.fileHolder.setAttribute(\"accept\", \"image/*\");\n      this.fileHolder.setAttribute(\"style\", \"visibility:hidden\");\n      this.fileHolder.onchange = this.fileChanged.bind(this);\n      document.body.appendChild(this.fileHolder);\n      this.fileHolder.click();\n      window.requestAnimationFrame(() => {\n        document.body.removeChild(this.fileHolder);\n      });\n    }\n  }\n  handleDrop(event) {\n    event.stopPropagation();\n    event.preventDefault();\n    if (event.dataTransfer && event.dataTransfer.files && event.dataTransfer.files.length) {\n      if (document.caretRangeFromPoint) {\n        const selection = document.getSelection();\n        const range = document.caretRangeFromPoint(event.clientX, event.clientY);\n        if (selection && range) {\n          selection.setBaseAndExtent(range.startContainer, range.startOffset, range.startContainer, range.startOffset);\n        }\n      } else {\n        const selection = document.getSelection();\n        const range = document.caretPositionFromPoint(event.clientX, event.clientY);\n        if (selection && range) {\n          selection.setBaseAndExtent(range.offsetNode, range.offset, range.offsetNode, range.offset);\n        }\n      }\n      this.range = this.quill.getSelection();\n      const file = event.dataTransfer.files[0];\n      setTimeout(() => {\n        this.range = this.quill.getSelection();\n        this.readAndUploadFile(file);\n      }, 0);\n    }\n  }\n  handlePaste(event) {\n    const clipboard = event.clipboardData || window.clipboardData;\n    if (clipboard && (clipboard.items || clipboard.files)) {\n      const items = clipboard.items || clipboard.files;\n      const IMAGE_MIME_REGEX = /^image\\/(jpe?g|gif|png|svg|webp)$/i;\n      for (let i = 0; i < items.length; i += 1) {\n        if (IMAGE_MIME_REGEX.test(items[i].type)) {\n          const file = items[i].getAsFile ? items[i].getAsFile() : items[i];\n          if (file) {\n            this.range = this.quill.getSelection();\n            event.preventDefault();\n            setTimeout(() => {\n              this.range = this.quill.getSelection();\n              this.readAndUploadFile(file);\n            }, 1);\n          }\n        }\n      }\n    }\n  }\n  readAndUploadFile(file) {\n    let isUploadReject = false;\n    const fileReader = new FileReader();\n    fileReader.addEventListener(\"load\", () => {\n      if (!isUploadReject) {\n        const base64ImageSrc = fileReader.result;\n        this.insertBase64Image(base64ImageSrc);\n      }\n    }, false);\n    if (file) {\n      fileReader.readAsDataURL(file);\n    }\n    this.options.upload(file).then(imageUrl => {\n      this.insertToEditor(imageUrl);\n    }, () => {\n      isUploadReject = true;\n      this.removeBase64Image();\n    });\n  }\n  fileChanged() {\n    const file = this.fileHolder.files[0];\n    this.readAndUploadFile(file);\n  }\n  insertBase64Image(url) {\n    const {\n      range\n    } = this;\n    this.quill.insertEmbed(range.index, \"imageBlot\", `${url}`, \"user\");\n  }\n  insertToEditor(url) {\n    const {\n      range\n    } = this;\n    this.quill.deleteText(range.index, 3, \"user\");\n    this.quill.insertEmbed(range.index, \"image\", `${url}`, \"user\");\n    range.index += 1;\n    this.quill.setSelection(range, \"user\");\n  }\n  removeBase64Image() {\n    const {\n      range\n    } = this;\n    this.quill.deleteText(range.index, 3, \"user\");\n  }\n}\nexport { ImageUploader };","map":{"version":3,"names":["ImageUploader","constructor","quill","options","range","toolbar","getModule","addHandler","selectLocalImage","bind","handleDrop","handlePaste","root","addEventListener","getSelection","fileHolder","document","createElement","setAttribute","onchange","fileChanged","body","appendChild","click","window","requestAnimationFrame","removeChild","event","stopPropagation","preventDefault","dataTransfer","files","length","caretRangeFromPoint","selection","clientX","clientY","setBaseAndExtent","startContainer","startOffset","caretPositionFromPoint","offsetNode","offset","file","setTimeout","readAndUploadFile","clipboard","clipboardData","items","IMAGE_MIME_REGEX","i","test","type","getAsFile","isUploadReject","fileReader","FileReader","base64ImageSrc","result","insertBase64Image","readAsDataURL","upload","then","imageUrl","insertToEditor","removeBase64Image","url","insertEmbed","index","deleteText","setSelection"],"sources":["/Users/prashant/Desktop/blog/node_modules/@mantine/rte/src/modules/image-uploader/ImageUploader.ts"],"sourcesContent":["interface Options {\n  upload(file: File): Promise<string>;\n}\n\nexport class ImageUploader {\n  quill: any;\n  options: Options;\n  range: any;\n  fileHolder: HTMLInputElement;\n\n  constructor(quill: any, options: Options) {\n    this.quill = quill;\n    this.options = options;\n    this.range = null;\n\n    const toolbar = this.quill.getModule('toolbar');\n    toolbar.addHandler('image', this.selectLocalImage.bind(this));\n\n    this.handleDrop = this.handleDrop.bind(this);\n    this.handlePaste = this.handlePaste.bind(this);\n\n    this.quill.root.addEventListener('drop', this.handleDrop, false);\n    this.quill.root.addEventListener('paste', this.handlePaste, false);\n  }\n\n  selectLocalImage() {\n    this.range = this.quill.getSelection();\n    if (this.range) {\n      this.fileHolder = document.createElement('input');\n      this.fileHolder.setAttribute('type', 'file');\n      this.fileHolder.setAttribute('accept', 'image/*');\n      this.fileHolder.setAttribute('style', 'visibility:hidden');\n\n      this.fileHolder.onchange = this.fileChanged.bind(this);\n\n      document.body.appendChild(this.fileHolder);\n\n      this.fileHolder.click();\n\n      window.requestAnimationFrame(() => {\n        document.body.removeChild(this.fileHolder);\n      });\n    }\n  }\n\n  handleDrop(event: any) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (event.dataTransfer && event.dataTransfer.files && event.dataTransfer.files.length) {\n      if (document.caretRangeFromPoint) {\n        const selection = document.getSelection();\n        const range = document.caretRangeFromPoint(event.clientX, event.clientY);\n        if (selection && range) {\n          selection.setBaseAndExtent(\n            range.startContainer,\n            range.startOffset,\n            range.startContainer,\n            range.startOffset\n          );\n        }\n      } else {\n        const selection = document.getSelection();\n        const range = (document as any).caretPositionFromPoint(event.clientX, event.clientY);\n        if (selection && range) {\n          selection.setBaseAndExtent(\n            range.offsetNode,\n            range.offset,\n            range.offsetNode,\n            range.offset\n          );\n        }\n      }\n\n      this.range = this.quill.getSelection();\n      const file = event.dataTransfer.files[0];\n\n      setTimeout(() => {\n        this.range = this.quill.getSelection();\n        this.readAndUploadFile(file);\n      }, 0);\n    }\n  }\n\n  handlePaste(event: any) {\n    const clipboard = event.clipboardData || (window as any).clipboardData;\n\n    if (clipboard && (clipboard.items || clipboard.files)) {\n      const items = clipboard.items || clipboard.files;\n      const IMAGE_MIME_REGEX = /^image\\/(jpe?g|gif|png|svg|webp)$/i;\n\n      for (let i = 0; i < items.length; i += 1) {\n        if (IMAGE_MIME_REGEX.test(items[i].type)) {\n          const file = items[i].getAsFile ? items[i].getAsFile() : items[i];\n\n          if (file) {\n            this.range = this.quill.getSelection();\n            event.preventDefault();\n            setTimeout(() => {\n              this.range = this.quill.getSelection();\n              this.readAndUploadFile(file);\n            }, 1);\n          }\n        }\n      }\n    }\n  }\n\n  readAndUploadFile(file: File) {\n    let isUploadReject = false;\n\n    const fileReader = new FileReader();\n\n    fileReader.addEventListener(\n      'load',\n      () => {\n        if (!isUploadReject) {\n          const base64ImageSrc = fileReader.result;\n          this.insertBase64Image(base64ImageSrc as string);\n        }\n      },\n      false\n    );\n\n    if (file) {\n      fileReader.readAsDataURL(file);\n    }\n\n    this.options.upload(file).then(\n      (imageUrl) => {\n        this.insertToEditor(imageUrl);\n      },\n      () => {\n        isUploadReject = true;\n        this.removeBase64Image();\n      }\n    );\n  }\n\n  fileChanged() {\n    const file = this.fileHolder.files[0];\n    this.readAndUploadFile(file);\n  }\n\n  insertBase64Image(url: string) {\n    const { range } = this;\n    this.quill.insertEmbed(range.index, 'imageBlot', `${url}`, 'user');\n  }\n\n  insertToEditor(url: string) {\n    const { range } = this;\n    this.quill.deleteText(range.index, 3, 'user');\n    this.quill.insertEmbed(range.index, 'image', `${url}`, 'user');\n\n    range.index += 1;\n    this.quill.setSelection(range, 'user');\n  }\n\n  removeBase64Image() {\n    const { range } = this;\n    this.quill.deleteText(range.index, 3, 'user');\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}